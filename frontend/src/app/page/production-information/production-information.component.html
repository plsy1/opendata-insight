<div *ngIf="isLoading" class="loading-state">
  <i class="fas fa-spinner fa-spin"></i>
  <span>{{ 'COMMON.LOADING' | translate }}</span>
</div>

<div class="page" *ngIf="!isLoading">

  <!-- ② Title + actions — 封面下方 -->
  <div class="head-row">
    <h1 class="movie-title">{{ movieData.title }}</h1>
    <div class="meta-pills">
      <span class="meta-pill"><i class="fas fa-hashtag"></i>{{ movieData.work_id }}</span>
      <span class="meta-pill" *ngIf="movieData.min_date">
        <i class="fas fa-calendar-alt"></i>{{ movieData.min_date }}
      </span>
      <span class="meta-pill" *ngIf="movieData.products[0]?.volume">
        <i class="fas fa-clock"></i>{{ movieData.products[0].volume }} min
      </span>
      <span class="meta-pill" *ngIf="movieData.products[0]?.price">
        <i class="fas fa-yen-sign"></i>{{ movieData.products[0].price }}
      </span>
    </div>
    <div class="actions">
      <button class="action-btn primary" (click)="downloadMovie()">
        <mat-icon>search</mat-icon> {{ 'COMMON.SEARCH' | translate }}
      </button>
      <button class="action-btn secondary" (click)="subscribeToMovie()">
        <mat-icon>rss_feed</mat-icon> {{ 'DETAILS.SUBSCRIBE' | translate }}
      </button>
      <button class="action-btn ghost" (click)="toJable(movieData.work_id)">
        <mat-icon>play_circle</mat-icon> Jable
      </button>
      <button class="action-btn ghost" (click)="toMissAV(movieData.work_id)">
        <mat-icon>videocam</mat-icon> MissAV
      </button>
    </div>
  </div>

  <!-- ③ 两栏正文 -->
  <div class="body-grid">

    <!-- 左: Details + Genres -->
    <section class="info-card">
      <div class="section-label"><i class="fas fa-info-circle"></i> {{ 'COMMON.DETAILS' | translate }}</div>
      <div class="detail-list">
        <div class="detail-row">
          <span class="detail-label">{{ 'DETAILS.MAKER' | translate }}</span>
          <span class="detail-value">{{ movieData.products[0].maker || "N/A" }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">{{ 'DETAILS.LABEL' | translate }}</span>
          <span class="detail-value">{{ movieData.products[0].label || "N/A" }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">{{ 'DETAILS.SERIES' | translate }}</span>
          <span class="detail-value">{{ movieData.products[0].series || "N/A" }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">{{ 'DETAILS.PRICE' | translate }}</span>
          <span class="detail-value">{{ movieData.products[0].price || "N/A" }}</span>
        </div>
      </div>

      <div class="section-label" style="margin-top: 20px;" *ngIf="(movieData.genres || []).length">
        <i class="fas fa-tags"></i> {{ 'DETAILS.GENRES' | translate }}
      </div>
      <div class="genre-chips" *ngIf="(movieData.genres || []).length">
        <span *ngFor="let genre of movieData.genres || []" class="genre-chip">{{ genre }}</span>
      </div>
    </section>

    <!-- 右: Performers -->
    <section class="info-card" *ngIf="(actors || []).length">
      <div class="section-label"><i class="fas fa-users"></i> {{ 'DETAILS.PERFORMERS' | translate }}</div>
      <div class="actors">
        <div
          *ngFor="let cast of actors || []"
          class="actor-item"
          (click)="searchByActressName(cast.name || '')"
        >
          <img
            loading="lazy"
            [src]="cast.image_url || 'assets/logo.svg'"
            alt="{{ cast.name || 'Unknown' }}"
            class="actor-avatar"
            [class.blurred]="common.enableBlur$ | async"
          />
          <div class="actor-name">{{ cast.name || "Unknown" }}</div>
        </div>
      </div>
    </section>

  </div>

  <!-- Samples (cover prepended as first image) -->
  <div class="sample-section" *ngIf="allSampleImages.length">
    <div class="section-label"><i class="fas fa-images"></i> {{ 'DETAILS.SAMPLES' | translate }}</div>
    <div class="sample-image-list" (wheel)="onWheelScroll($event)">
      <img
        loading="lazy"
        *ngFor="let src of allSampleImages; let i = index"
        [src]="src || 'assets/logo.svg'"
        alt="Sample Image"
        class="sample-image"
        [class.blurred]="common.enableBlur$ | async"
        (click)="openLightbox(i)"
      />
    </div>
  </div>

  <!-- ⑤ Lightbox -->
  <div class="lightbox-overlay" *ngIf="lightboxOpen" (click)="closeLightbox()">
    <div class="lightbox-inner" (click)="$event.stopPropagation()">

      <!-- Toolbar: close only -->
      <div class="lb-toolbar">
        <button class="lb-btn" (click)="closeLightbox()" title="Close (Esc)">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Prev -->
      <button class="lb-btn lb-prev" (click)="prevImage()" [hidden]="lightboxImages.length <= 1">
        <i class="fas fa-chevron-left"></i>
      </button>

      <!-- Main image — wheel to zoom, drag to pan -->
      <img
        [src]="lightboxSrc"
        alt="Sample"
        class="lb-img"
        [style.transform]="lbTransform"
        [style.cursor]="lbCursor"
        (wheel)="onLbWheel($event)"
        (mousedown)="onLbMouseDown($event)"
      />

      <!-- Next -->
      <button class="lb-btn lb-next" (click)="nextImage()" [hidden]="lightboxImages.length <= 1">
        <i class="fas fa-chevron-right"></i>
      </button>

      <!-- Bottom bar: counter + hint -->
      <div class="lb-footer">
        <div class="lb-counter">{{ lightboxIndex + 1 }} / {{ lightboxImages.length }}</div>
        <div class="lb-hint"><i class="fas fa-scroll"></i> {{ 'DETAILS.LIGHTBOX_HINT' | translate }}</div>
      </div>
    </div>
  </div>



</div>
