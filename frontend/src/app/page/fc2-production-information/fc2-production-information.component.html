<div *ngIf="isLoading" class="loading-state">
  <i class="fas fa-spinner fa-spin"></i>
  <span>Loading...</span>
</div>

<div class="page" *ngIf="!isLoading && data">
  <!-- ① Hero Row: Title, Meta and Actions -->
  <div class="head-row">
    <h1 class="movie-title">{{ data.product_id }} - {{ data.title }}</h1>
    <div class="meta-pills">
      <span class="meta-pill" *ngIf="data.author">
        <i class="fas fa-person"></i>{{ data.author }}
      </span>
      <span class="meta-pill" *ngIf="data.sale_day">
        <i class="fas fa-calendar-alt"></i>{{ data.sale_day }}
      </span>
      <span class="meta-pill" *ngIf="data.duration">
        <i class="fas fa-clock"></i>{{ data.duration }}
      </span>
    </div>
    
    <div class="actions">
      <button class="action-btn primary" (click)="onSearchClick()">
        <mat-icon>search</mat-icon> Search
      </button>
      <button class="action-btn secondary" (click)="onSubscribeClick()">
        <mat-icon>rss_feed</mat-icon> Subscribe
      </button>
      <button class="action-btn ghost" (click)="toSupjav()">
        <mat-icon>play_circle</mat-icon> Supjav
      </button>
      <button class="action-btn ghost" (click)="toMissAV()">
        <mat-icon>videocam</mat-icon> MissAV
      </button>
    </div>
  </div>

  <!-- ② Body: Cover and Details -->
  <div class="body-grid">
    <!-- Left: Cover Image -->
    <div class="cover-column">
      <div class="cover-wrapper glass-effect">
        <img [src]="data.cover" alt="cover" class="cover-img" />
      </div>
    </div>

    <!-- Right: Info Cards -->
    <div class="info-column">
      <section class="info-card">
        <div class="section-label"><i class="fas fa-info-circle"></i> Details</div>
        <div class="detail-list">
          <div class="detail-row">
            <span class="detail-label">Maker / Author</span>
            <span class="detail-value">{{ data.author || "N/A" }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Sale Day</span>
            <span class="detail-value">{{ data.sale_day || "N/A" }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Duration</span>
            <span class="detail-value">{{ data.duration || "N/A" }}</span>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- ③ Sample Images -->
  <div class="sample-section" *ngIf="allSampleImages.length">
    <div class="section-label"><i class="fas fa-images"></i> Samples</div>
    <div class="sample-image-list" (wheel)="onWheelScroll($event)">
      <img
        loading="lazy"
        *ngFor="let image of allSampleImages; let i = index"
        [src]="image"
        class="sample-image"
        (click)="openLightbox(i)"
      />
    </div>
  </div>

  <!-- ④ Lightbox Overlay -->
  <div class="lightbox-overlay" *ngIf="lightboxOpen" (click)="closeLightbox()">
    <div class="lightbox-inner" (click)="$event.stopPropagation()">
      <div class="lb-toolbar">
        <button class="lb-btn" (click)="closeLightbox()" title="Close (Esc)">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <button class="lb-btn lb-prev" (click)="prevImage()" [hidden]="lightboxImages.length <= 1">
        <i class="fas fa-chevron-left"></i>
      </button>

      <img
        [src]="lightboxSrc"
        alt="Sample"
        class="lb-img"
        [style.transform]="lbTransform"
        [style.cursor]="lbCursor"
        (wheel)="onLbWheel($event)"
        (mousedown)="onLbMouseDown($event)"
      />

      <button class="lb-btn lb-next" (click)="nextImage()" [hidden]="lightboxImages.length <= 1">
        <i class="fas fa-chevron-right"></i>
      </button>

      <div class="lb-footer">
        <div class="lb-counter">{{ lightboxIndex + 1 }} / {{ lightboxImages.length }}</div>
        <div class="lb-hint"><i class="fas fa-scroll"></i> Scroll to zoom · Drag to pan</div>
      </div>
    </div>
  </div>
</div>
